---
import Layout from '../layouts/BlogPost.astro';

const pageTitle = "Submit Your Story";
const pageDescription = "Submit your exceptional 19th hole moments with the Order for preservation in the Archive";
---

<Layout title={pageTitle} description={pageDescription} pubDate={new Date()} showHeader={false}>
  <style is:global>
    /* Hide the ShareButtons and PostMeta */
    .prose > div:first-child,
    .prose > div:nth-child(2) {
      display: none !important;
    }
    /* Hide the footer on this page */
    footer#contact {
      display: none !important;
    }
  </style>

  <!-- Hero Section -->
  <section class="w-full py-16 md:py-24">
    <div class="mx-auto max-w-4xl px-4">
      <h1 class="mb-6 text-4xl md:text-5xl lg:text-6xl font-bold text-center text-[#047857] dark:text-[#34d399]">
        Submit Your Story
      </h1>
      <p class="text-xl md:text-2xl text-center text-neutral-700 dark:text-neutral-300 mb-8 max-w-3xl mx-auto leading-relaxed">
        Every round has a story. Share yours and contribute to the living history of the 19th hole.
      </p>
    </div>
  </section>

  <!-- Submission Form Section -->
  <section class="w-full py-16">
    <div class="mx-auto max-w-3xl px-4">
      <h2 class="text-3xl font-bold mb-4 text-center text-neutral-800 dark:text-neutral-100">
        Submit Your Story
      </h2>
      <p class="text-center text-neutral-700 dark:text-neutral-300 mb-8">
        All fields are required unless marked optional
      </p>

      <!-- Form -->
      <form id="storyForm" class="space-y-6 p-8 bg-neutral-50 dark:bg-neutral-900/50 rounded-xl">
        <!-- Your Name -->
        <div>
          <label for="authorName" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Your Name <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <input 
            type="text" 
            id="authorName" 
            name="authorName" 
            required
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="How should we credit you?"
          />
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Email Address <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            required
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="your.email@example.com"
          />
          <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-400">
            Used only to contact you if your story is selected
          </p>
        </div>

        <!-- Member ID (Optional) -->
        <div>
          <label for="memberId" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Member ID <span class="text-neutral-500">(optional)</span>
          </label>
          <input 
            type="text" 
            id="memberId" 
            name="memberId"
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="e.g., XIX-123"
          />
          <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-400">
            If you're an Associate, include your Member ID for recognition
          </p>
        </div>

        <!-- Story Title -->
        <div>
          <label for="storyTitle" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Story Title <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <input 
            type="text" 
            id="storyTitle" 
            name="storyTitle" 
            required
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="What should we call this story?"
          />
        </div>

        <!-- Story Type -->
        <div>
          <label for="storyType" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Story Type <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <select 
            id="storyType" 
            name="storyType" 
            required
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
          >
            <option value="">Choose a category...</option>
            <option value="legendary-moment">Legendary Moment</option>
            <option value="historical">Historical Story</option>
            <option value="venue-discovery">Exceptional Venue</option>
            <option value="wisdom">Wisdom & Philosophy</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Location (Optional) -->
        <div>
          <label for="location" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Location <span class="text-neutral-500">(optional)</span>
          </label>
          <input 
            type="text" 
            id="location" 
            name="location"
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="Where did this take place?"
          />
        </div>

        <!-- Year/Era (Optional) -->
        <div>
          <label for="timeframe" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Year or Era <span class="text-neutral-500">(optional)</span>
          </label>
          <input 
            type="text" 
            id="timeframe" 
            name="timeframe"
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
            placeholder="e.g., 1952, Early 2000s, Summer of '87"
          />
        </div>

        <!-- The Story -->
        <div>
          <label for="storyContent" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            Your Story <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <textarea 
            id="storyContent" 
            name="storyContent" 
            required
            rows="12"
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent resize-y"
            placeholder="Tell us the story. Write as if you're speaking at the 19th hole itself, with detail, atmosphere, and respect for the tradition."
          ></textarea>
          <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-400">
            Minimum 200 words. Take your time. Quality submissions receive priority review.
          </p>
        </div>

        <!-- How You Heard About This -->
        <div>
          <label for="source" class="block text-sm font-medium mb-2 text-neutral-800 dark:text-neutral-200">
            How did you hear this story? <span class="text-[#047857] dark:text-[#34d399]">*</span>
          </label>
          <select 
            id="source" 
            name="source" 
            required
            class="w-full px-4 py-3 rounded-lg border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 focus:ring-2 focus:ring-[#0ea472] focus:border-transparent"
          >
            <option value="">Choose one...</option>
            <option value="witnessed">I witnessed it personally</option>
            <option value="told-firsthand">Told to me firsthand</option>
            <option value="local-legend">Local legend/oral tradition</option>
            <option value="historical-research">Historical research</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Publication Consent -->
        <div class="space-y-3">
          <div class="flex items-start">
            <input 
              type="checkbox" 
              id="publicationConsent" 
              name="publicationConsent" 
              required
              class="mt-1 h-4 w-4 text-[#047857] dark:text-[#34d399] border-neutral-300 dark:border-neutral-600 rounded focus:ring-[#0ea472]"
            />
            <label for="publicationConsent" class="ml-3 text-sm text-neutral-700 dark:text-neutral-300">
              I grant the Order permission to publish this story in The Archive, with proper credit given <span class="text-[#047857] dark:text-[#34d399]">(required)</span>
            </label>
          </div>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit"
          class="w-full px-8 py-4 bg-[#0ea472] !text-white font-semibold rounded-lg hover:bg-[#0c8a5f] active:bg-[#0a7350] transition-colors duration-200 shadow-lg hover:shadow-xl"
        >
          Submit Your Story
        </button>

        <!-- Success/Error Messages -->
        <div id="formMessage" class="hidden mt-4 p-4 rounded-lg"></div>
      </form>
    </div>
  </section>

  <!-- Story Guidelines Section -->
  <section class="w-full py-16 bg-white dark:bg-neutral-900">
    <div class="mx-auto max-w-4xl px-4">
      <h2 class="text-2xl font-bold mb-8 text-center text-neutral-800 dark:text-neutral-100">
        What We're Looking For
      </h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
        <!-- Legendary Moments -->
        <div class="p-6 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-3">Legendary Moments</h3>
          <p class="text-neutral-700 dark:text-neutral-300 leading-relaxed">
            The shot that defied probability. The round that broke records. The day greatness revealed itself on the course. If it belongs in golf's eternal ledger, we want to preserve it.
          </p>
        </div>

        <!-- Historical Significance -->
        <div class="p-6 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-3">Historical Significance</h3>
          <p class="text-neutral-700 dark:text-neutral-300 leading-relaxed">
            Stories from golf's past that shaped the game. Forgotten legends. Lost traditions. Events that changed the course of history. We are custodians of memory.
          </p>
        </div>

        <!-- Exceptional Venues -->
        <div class="p-6 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-3">Exceptional Venues</h3>
          <p class="text-neutral-700 dark:text-neutral-300 leading-relaxed">
            Sacred grounds where the game lives in its purest form. Courses with soul. Hidden gems known only to a devoted few. Places where every blade of grass tells a story.
          </p>
        </div>

        <!-- Wisdom & Philosophy -->
        <div class="p-6 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-3">Wisdom & Philosophy</h3>
          <p class="text-neutral-700 dark:text-neutral-300 leading-relaxed">
            The lessons golf teaches. The philosophy of the game. Stories that reveal deeper truths about honor, perseverance, and the pursuit of excellence.
          </p>
        </div>
      </div>

      <!-- Quality Message -->
      <div class="p-6 bg-[#0ea472]/10 border-l-4 border-[#0ea472] rounded">
        <p class="text-neutral-800 dark:text-neutral-200 leading-relaxed">
          <span class="font-bold">Every story matters.</span> We review each submission personally and look for authenticity, quality of writing, and stories that embody the spirit of the 19th hole tradition.
        </p>
      </div>
    </div>
  </section>

  <!-- What Happens Next Section -->
  <section class="w-full py-12 bg-neutral-50 dark:bg-neutral-900/50">
    <div class="mx-auto max-w-4xl px-4">
      <h2 class="text-2xl font-bold mb-6 text-center text-neutral-800 dark:text-neutral-100">
        What Happens Next
      </h2>
      
      <div class="space-y-6 text-neutral-700 dark:text-neutral-300">
        <div class="p-6 bg-white dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-2">Personal Review</h3>
          <p class="leading-relaxed">
            Every submission is read personally. We look for authenticity, quality of writing, and stories that embody the spirit of the 19th hole tradition.
          </p>
        </div>

        <div class="p-6 bg-white dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-2">Selection for Publication</h3>
          <p class="leading-relaxed">
            We review every story personally. If your story is selected for The Archive, we'll notify you when it's published. Selected authors receive recognition and, if they're Associates, may be invited to advance in title.
          </p>
        </div>

        <div class="p-6 bg-white dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-2">Respectful Consideration</h3>
          <p class="leading-relaxed">
            Not every story will be published, but every story matters. Even if yours isn't selected this time, we encourage you to continue sharing. The act of preservation is itself an honor.
          </p>
        </div>

        <div class="p-6 bg-white dark:bg-neutral-800 rounded-lg">
          <h3 class="font-bold text-neutral-800 dark:text-neutral-100 mb-2">Your Privacy is Sacred</h3>
          <p class="leading-relaxed">
            Your email and personal details are used only for communication about your submission. We never share, sell, or distribute your information. Discretion is a cornerstone of the Order.
          </p>
        </div>
      </div>
    </div>
  </section>

  <script>
    console.log('Story form script loaded');
    
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM Content Loaded');
      
      const form = document.getElementById('storyForm') as HTMLFormElement | null;
      console.log('Story form element:', form);
      
      if (!form) {
        console.error('Form with id="storyForm" not found');
        return;
      }
      
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        console.log('Story form submitted');
        
        const formData = new FormData(form);
        const messageDiv = document.getElementById('formMessage');
        const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
        
        if (!messageDiv) {
          console.error('Message div not found');
          return;
        }
        
        // Show processing message
        messageDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200';
        messageDiv.textContent = 'Submitting your story...';
        messageDiv.classList.remove('hidden');
        
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.textContent = 'Submitting...';
        }
        
        try {
          console.log('Sending story to API...');
          
          const response = await fetch('/api/submit-story', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              submitterName: formData.get('authorName'),
              submitterEmail: formData.get('email'),
              memberId: formData.get('memberId') || '',
              storyTitle: formData.get('storyTitle'),
              storyType: formData.get('storyType'),
              location: formData.get('location') || '',
              yearEra: formData.get('timeframe') || '',
              storyContent: formData.get('storyContent'),
              howHeard: formData.get('source'),
              permissionGranted: formData.get('publicationConsent') === 'on',
            }),
          });
          
          console.log('Response status:', response.status);
          const result = await response.json();
          console.log('Response data:', result);
          
          if (response.ok && result.success) {
            messageDiv.className = 'mt-4 p-4 rounded-lg bg-[#0ea472]/10 border-2 border-[#0ea472] text-neutral-800 dark:text-neutral-200';
            messageDiv.innerHTML = '<div class="text-center"><div class="text-xl font-bold mb-2">Story Submitted Successfully!</div><div>The Curators will review it with care. If selected for publication, we\'ll notify you via email.</div></div>';
            form.reset();
          } else {
            throw new Error(result.error || 'Submission failed');
          }
        } catch (error) {
          console.error('Error submitting story:', error);
          messageDiv.className = 'mt-4 p-4 rounded-lg bg-red-50 border-2 border-red-500 text-red-800 dark:bg-red-900/20 dark:text-red-200';
          messageDiv.textContent = 'There was an error submitting your story. Please try again or contact us directly.';
        } finally {
          if (submitButton) {
            submitButton.disabled = false;
            submitButton.textContent = 'Submit Your Story';
          }
        }
      });
    });
  </script>
</Layout>




